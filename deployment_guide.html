<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deployment Guide: Magicians' AI Wizard</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        h1, h2, h3 {
            color: #111;
            line-height: 1.2;
        }
        h1 {
            font-size: 2.5em;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        h2 {
            font-size: 2em;
            margin-top: 40px;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        h3 {
            font-size: 1.5em;
            margin-top: 30px;
        }
        code {
            font-family: "Courier New", Courier, monospace;
            background-color: #eee;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.95em;
        }
        pre {
            background-color: #2d2d2d;
            color: #f1f1f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        pre code {
            background-color: transparent;
            padding: 0;
            font-size: 0.9em;
        }
        strong {
            color: #000;
        }
        .note {
            background-color: #fff9e6;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .note strong {
            color: #c79100;
        }
    </style>
</head>
<body>

    <h1>Deployment Guide: Magicians' AI Wizard</h1>
    <p>This document provides a comprehensive guide to deploying your application to a custom domain. It covers project setup, securing your API key, and hosting on a modern platform.</p>

    <h2>Overview of the Deployment Strategy</h2>
    <ol>
        <li><strong>Prepare the App for Production:</strong> We'll set up a standard project structure and a build process to bundle your code into optimized static files.</li>
        <li><strong>Secure the API Key:</strong> This is the most important step. We will create a simple backend "proxy" using a serverless function. This is a standard industry practice that prevents your secret API key from being exposed to the public.</li>
        <li><strong>Host the Static Files:</strong> We'll choose a modern hosting platform that can serve your static files and run the serverless function.</li>
        <li><strong>Configure Your Domain:</strong> We'll point your custom domain name (e.g., <code>www.your-magic-app.com</code>) to the hosting provider.</li>
    </ol>

    <h2>Step 1: Preparing Your Application for Production</h2>
    <p>Your current setup is great for development, but for production, we need to create a more standard project structure and build your TypeScript/React code into plain JavaScript. We'll use <strong>Vite</strong>, a popular and extremely fast build tool.</p>

    <h3>1. Create a Project Folder:</h3>
    <ul>
        <li>Put all your existing files (<code>index.html</code>, <code>index.tsx</code>, <code>components/</code>, etc.) into a new folder. Let's call it <code>magic-ai-app</code>.</li>
        <li>Inside that folder, create a <code>src</code> directory and move all your <code>.ts</code>, <code>.tsx</code>, and component/service folders into it. Your <code>index.html</code>, <code>sw.js</code>, <code>manifest.json</code>, and <code>icon.svg</code> files should remain in the root directory.</li>
    </ul>

    <h3>2. Initialize a Node.js Project:</h3>
    <p>Open a terminal in your <code>magic-ai-app</code> folder and run this command. It creates a <code>package.json</code> file.</p>
    <pre><code>npm init -y</code></pre>

    <h3>3. Install Vite and Dependencies:</h3>
    <p>Run the following command to install Vite and the necessary types:</p>
    <pre><code>npm install vite @vitejs/plugin-react typescript @types/react @types/react-dom @types/node --save-dev</code></pre>

    <h3>4. Update <code>index.html</code>:</h3>
    <p>Vite will handle your dependencies, so you need to remove the <code>importmap</code> and change the script tag. Modify your <code>index.html</code> to look like this:</p>
    <pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;!-- ... (keep all your other head tags) ... --&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id="root"&gt;&lt;/div&gt;
    &lt;!-- Update this script tag --&gt;
    &lt;script type="module" src="/src/index.tsx"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

    <h3>5. Create a Vite Configuration File:</h3>
    <p>In the root of <code>magic-ai-app</code>, create a file named <code>vite.config.ts</code> and add the following code:</p>
    <pre><code>import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
});
</code></pre>

    <h3>6. Add Build Scripts to <code>package.json</code>:</h3>
    <p>Open your <code>package.json</code> file and add the <code>scripts</code> section:</p>
    <pre><code>{
  // ... other package.json content
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  }
  // ...
}
</code></pre>
    <p>Now you can run <code>npm run dev</code> to start a development server, and more importantly, run <code>npm run build</code> to create a production-ready <code>dist</code> folder containing your optimized static files.</p>

    <h2>Step 2: Securing Your Gemini API Key (Crucial!)</h2>
    <div class="note">
        <strong>Important:</strong> You <strong>cannot</strong> put your <code>API_KEY</code> directly in your frontend code. If you do, anyone visiting your site can steal it. We will solve this with a serverless function that acts as a secure proxy.
    </div>
    
    <h3>How it works:</h3>
    <ul>
        <li>Your React app will send the user's prompt to a special URL on your <em>own domain</em> (e.g., <code>/api/generate</code>).</li>
        <li>This URL will trigger your serverless function.</li>
        <li>The serverless function (running on the server, not in the user's browser) will securely access your <code>API_KEY</code> from an environment variable.</li>
        <li>It will then call the real Gemini API, get the response, and send it back to your React app.</li>
    </ul>

    <h3>1. Create a Serverless Function:</h3>
    <ul>
        <li>Create a folder named <code>api</code> in your project's root.</li>
        <li>Inside <code>api</code>, create a file named <code>generate.ts</code>.</li>
    </ul>

    <h3>2. Write the Proxy Code:</h3>
    <p>First, install the Gemini SDK for the backend: <code>npm install @google/genai</code>. Then, add the following code to <code>api/generate.ts</code>. This example is for Vercel's format, but Netlify is very similar.</p>
    <pre><code>// api/generate.ts
import { GoogleGenAI } from '@google/genai';
import type { VercelRequest, VercelResponse } from '@vercel/node';

export default async function handler(req: VercelRequest, res: VercelResponse) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  const { prompt, systemInstruction, history } = req.body;
  const apiKey = process.env.API_KEY; // Securely accessed on the server

  if (!apiKey) {
    return res.status(500).json({ error: 'API key not configured' });
  }
  
  try {
    const ai = new GoogleGenAI({ apiKey });
    // This logic mirrors your `generateResponse` function
    const model = ai.models.generateContent({
      model: 'gemini-2.5-pro', // Or determine dynamically
      contents: [...(history || []), { role: 'user', parts: [{ text: prompt }] }],
      config: { systemInstruction },
    });
    
    const response = await model;
    res.status(200).json({ text: response.text });

  } catch (error) {
    console.error(error);
    res.status(500).json({ error: 'Failed to communicate with the AI' });
  }
}
</code></pre>

    <h3>3. Update Your Frontend Service:</h3>
    <p>Modify your <code>services/geminiService.ts</code> to call your new proxy instead of the Gemini API directly. You can remove the <code>GoogleGenAI</code> initialization from the frontend.</p>
    <pre><code>// services/geminiService.ts (simplified example)
export const generateResponse = async (prompt: string, systemInstruction: string, history?: ChatMessage[]): Promise&lt;string&gt; => {
  try {
    const response = await fetch('/api/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ prompt, systemInstruction, history }),
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error || 'API request failed');
    }

    const data = await response.json();
    return data.text;
  } catch (error) {
    console.error("Error calling proxy API:", error);
    return "An error occurred while communicating with the AI.";
  }
};
// ... update other functions like identifyTrickFromImage similarly
</code></pre>

    <h2>Step 3 & 4: Hosting and Domain Configuration</h2>
    <p>I highly recommend using <strong>Vercel</strong> or <strong>Netlify</strong>. They are built for exactly this type of application, have generous free tiers, and make the whole process incredibly smooth.</p>
    
    <ol>
        <li><strong>Sign up:</strong> Create an account on <a href="https://vercel.com/">Vercel</a> or <a href="https://www.netlify.com/">Netlify</a>.</li>
        <li><strong>Push to Git:</strong> Push your project code to a GitHub, GitLab, or Bitbucket repository.</li>
        <li><strong>Create a New Project:</strong> In your Vercel/Netlify dashboard, create a "New Project" and connect it to your Git repository.</li>
        <li>
            <strong>Configure Settings:</strong>
            <ul>
                <li>The platform will automatically detect you're using Vite. The build command (<code>npm run build</code>) and output directory (<code>dist</code>) should be pre-filled correctly.</li>
                <li><strong>Crucially, find the "Environment Variables" section in the project settings.</strong> Add a new variable named <code>API_KEY</code> and paste your secret Gemini API key as the value. This makes it securely available to your serverless function.</li>
            </ul>
        </li>
        <li><strong>Deploy:</strong> Click the "Deploy" button. The platform will pull your code, run the build, and host your site on a temporary URL.</li>
        <li>
            <strong>Add Your Custom Domain:</strong>
            <ul>
                <li>Purchase a domain name from a registrar like Google Domains, Namecheap, etc.</li>
                <li>In your Vercel/Netlify project's "Domains" tab, add your custom domain.</li>
                <li>The platform will give you DNS records (like an <code>A</code> record or <code>CNAME</code> record) to add to your domain registrar's settings. Follow their simple instructions.</li>
                <li>After a short while (from minutes to a few hours), your domain will point to your new live application, complete with a free SSL certificate (HTTPS).</li>
            </ul>
        </li>
    </ol>
    <p>Your application is now live and secure on your own domain! Every time you push a change to your Git repository, Vercel/Netlify will automatically rebuild and deploy the update for you.</p>

</body>
</html>
